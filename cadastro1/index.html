<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crie Seu Acesso Agora</title>
    
    <!-- Cor de Tema do Navegador -->
    <meta name="theme-color" content="#6a11cb">

    <!-- Script de Rastreamento UTM (CORRIGIDO) -->
    <script>
    // trakiefy-latest.js v1.0.0 - Seu Utmify 100% grátis e melhor que o original
    // Envolve todo o script em DOMContentLoaded para garantir que o body exista
    document.addEventListener("DOMContentLoaded", () => {
      const keys = ['utm_source','utm_medium','utm_campaign','utm_content','utm_term','gclid','fbclid','ttclid','xcod','sck','src','click_id','cid'];
      const storage = localStorage;
      const expDays = 7 * 24 * 60 * 60 * 1000; // 7 dias

      // 1. Salva todos os parâmetros que chegaram na URL
      new URLSearchParams(location.search).forEach((value, key) => {
        if (keys.includes(key)) {
          storage.setItem(key, value);
          storage.setItem(key + '_exp', Date.now() + expDays);
        }
      });

      // 2. Codifica xcod/sck com caracteres invisíveis
      const encodeInvisible = (str) => str.replace(/[0-9a-f]/gi, c => String.fromCharCode(8203 + parseInt(c, 16)));

      // 3. Restaura UTM em todos os links + injeta xcod/sck no WhatsApp
      const restoreLinks = () => {
        document.querySelectorAll('a[href]').forEach(link => {
          if (!link.href || link.href.includes('mailto:') || link.href.includes('#')) return;

          try {
            const url = new URL(link.href);

            // Restaura UTM normais
            keys.forEach(key => {
              const val = storage.getItem(key);
              const exp = storage.getItem(key + '_exp');
              if (val && exp && Date.now() < +exp) {
                url.searchParams.set(key, val);
              }
            });

            // WhatsApp: injeta xcod/sck codificado no campo text
            if (url.hostname.includes('wa.me') || url.hostname.includes('api.whatsapp.com') || url.hostname.includes('chat.whatsapp.com')) {
              const clickId = storage.getItem('xcod') || storage.getItem('sck') || '';
              if (clickId) {
                const encoded = encodeInvisible(clickId);
                const currentText = url.searchParams.get('text') || 'Olá';
                url.searchParams.set('text', currentText + ' ' + encoded);
              }
            }

            link.href = url.toString();
          } catch (e) {}
        });
      };

      // Executa agora + sempre que mudar o DOM
      restoreLinks();
      // Agora o document.body existe, então o MutationObserver funcionará
      new MutationObserver(restoreLinks).observe(document.body, { childList: true, subtree: true });
      setTimeout(restoreLinks, 1500);
      setTimeout(restoreLinks, 4000);
    });
    </script>

    <!-- FAVICONS E ÍCONES DE APLICATIVO -->
    <link rel="icon" href="images/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="images/favicon-96x96.png" type="image/png" sizes="96x96">
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="manifest" href="images/site.webmanifest">

    <!-- Nosso CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
<main class="container">
        <div class="form-card">
            <h1>Crie Seu Acesso Agora</h1>
            <p class="subtitle">Preencha seus dados abaixo para liberar sua área de membros.</p>

            <form id="form-captura" data-checkout="https://go.tribopay.com.br/34pb63cfbf">
                <div class="input-group">
                    <input type="text" name="nome" id="nome" placeholder=" " required>
                    <label for="nome">Digite seu nome completo</label>
                </div>
                
                <div class="input-group">
                    <input type="email" name="email" id="email" placeholder=" " required>
                    <label for="email">Digite seu melhor e-mail</label>
                </div>
                
                <div class="input-group">
                    <input type="tel" name="celular" id="celular" placeholder=" " maxlength="15" required>
                    <label for="celular">DDD + WhatsApp</label>
                </div>

                <!-- NOVO CAMPO DE CPF -->
                <div class="input-group">
                    <input type="text" name="cpf" id="cpf" placeholder=" " maxlength="14" pattern="\d{3}\.\d{3}\.\d{3}-\d{2}" required>
                    <label for="cpf">Digite seu CPF</label>
                </div>

                <button type="submit" id="liberar-acesso" class="btn-primary">
                    <span class="btn-text">LIBERAR MEU ACESSO AGORA</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </form>

            <div id="msg-erro" class="msg-error hidden">Ocorreu um erro. Tente novamente.</div>
            
            <p class="info-text">
                <i class="fas fa-lock"></i>
                Na próxima página você terá a opção de escolher pagamento à vista ou em até 9 parcelas.
            </p>
        </div>
    </main>

    <script src="js/script.js"></script>
</body>
</html>